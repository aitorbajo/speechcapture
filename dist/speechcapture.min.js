window.speechcapture=function(){var a={WAV_BLOB:1,WEBAUDIO_AUDIOBUFFER:2,RAW_DATA:3},b={SPEECH_STARTED:1,SPEECH_STOPPED:2,SPEECH_ERROR:3,CAPTURE_STARTED:4,CAPTURE_STOPPED:5,CAPTURE_ERROR:6,ENCODING_ERROR:7,SPEECH_MAX_LENGTH:8,SPEECH_MIN_LENGTH:9},c={NO_ERROR:0,INVALID_PARAMETER:1,MISSING_PARAMETER:2,NO_WEB_AUDIO_SUPPORT:3,CAPTURE_ALREADY_STARTED:4,UNSPECIFIED:999},d={SAMPLERATE:22050,AUDIOSOURCE_TYPE:7,CHANNELS:1,FORMAT:"PCM_16BIT",BUFFER_SIZE:16384,CONCATENATE_MAX_CHUNKS:1,SPEECH_DETECTION_THRESHOLD:15,SPEECH_DETECTION_ALLOWED_DELAY:400,SPEECH_DETECTION_MAX_LENGTH:500,SPEECH_DETECTION_MIN_LENGTH:1e4,SPEECH_DETECTION_COMPRESS_PAUSES:!1,SPEECH_DETECTION_ANALYSIS_CHUNK_LENGTH:100,AUDIO_RESULT_TYPE:1,DEBUG_ALERTS:!1,DEBUG_CONSOLE:!1},e=function(e,f,g,h){if(!window.audioinput)throw"error: Requires 'cordova-plugin-audioinput'";if(audioinput.isCapturing())T=c.CAPTURE_ALREADY_STARTED,$(b.CAPTURE_ERROR);else{if(!f)throw T=c.MISSING_PARAMETER,"error: Mandatory parameter 'speechCapturedCB' is missing.";if("function"!=typeof f)throw T=c.INVALID_PARAMETER,"error: Parameter 'speechCapturedCB' must be of type function.";if(g&&"function"!=typeof g)throw T=c.INVALID_PARAMETER,"error: Parameter 'errorCB' must be of type function.";if(h&&"function"!=typeof h)throw T=c.INVALID_PARAMETER,"error: Parameter 'speechStatusCB' must be of type function.";if(e||(e={}),U={},U.sampleRate=e.sampleRate||d.SAMPLERATE,U.bufferSize=e.bufferSize||d.BUFFER_SIZE,U.audioSourceType=e.audioSourceType||d.AUDIOSOURCE_TYPE,U.concatenateMaxChunks=d.CONCATENATE_MAX_CHUNKS,U.channels=d.CHANNELS,U.format=d.FORMAT,U.speechCapturedCB=f,U.errorCB=g||null,U.speechStatusCB=h||null,U.speechDetectionThreshold=e.speechDetectionThreshold||d.SPEECH_DETECTION_THRESHOLD,U.speechDetectionMinimum=e.speechDetectionMinimum||d.SPEECH_DETECTION_MIN_LENGTH,U.speechDetectionMaximum=e.speechDetectionMaximum||d.SPEECH_DETECTION_MAX_LENGTH,U.speechDetectionAllowedDelay=e.speechDetectionAllowedDelay||d.SPEECH_DETECTION_ALLOWED_DELAY,U.audioResultType=e.audioResultType||d.AUDIO_RESULT_TYPE,U.audioContext=e.audioContext||null,U.compressPauses=e.compressPauses||d.SPEECH_DETECTION_COMPRESS_PAUSES,U.analysisChunkLength=e.analysisChunkLength||d.SPEECH_DETECTION_ANALYSIS_CHUNK_LENGTH,U.debugAlerts=e.debugAlerts||d.DEBUG_ALERTS,U.debugConsole=e.debugConsole||d.DEBUG_CONSOLE,U.audioResultType===a.WEBAUDIO_AUDIOBUFFER&&!va(U.audioContext))throw T=c.NO_WEB_AUDIO_SUPPORT,"error: audioResultType is WEBAUDIO_AUDIOBUFFER, but Web Audio not supported on this platform!";ha(),window.removeEventListener("audioinput",m,!1),window.addEventListener("audioinput",m,!1),window.removeEventListener("audioinputerror",n,!1),window.addEventListener("audioinputerror",n,!1),V={sampleRate:U.sampleRate,bufferSize:U.bufferSize,channels:U.channels,format:U.format,audioSourceType:U.audioSourceType,streamToWebAudio:!1},audioinput.start(V),W(U.sampleRate,U.bufferSize),_(),$(b.CAPTURE_STARTED)}},f=function(){window.audioinput&&audioinput.isCapturing()&&window.audioinput.stop(),z.length>0&&sa(z),ha(),$(b.CAPTURE_STOPPED)},g=function(){return!!window.audioinput&&audioinput.isCapturing()},h=function(){return Q},i=function(){return U},j=function(){return B?parseFloat(B).toFixed(0):-1},k=function(){var a=!1;return window.audioinput&&(a=audioinput.isCapturing()),{currentLevel:parseFloat(B).toFixed(0),ambientAverageLevel:parseFloat(F).toFixed(0),currentThreshold:parseFloat(C).toFixed(0),currentSpeechChunks:A,currentSpeechBufferSize:z.length,noSpeechLength:D,constraints:{allowedDelayChunks:K,minimumLengthChunks:L,maximumLengthChunks:M},internals:{AnalysisBuffersPerIteration:H,getNextBufferIterations:N,audioInputFrequency:I,inputBufferLenInS:parseFloat(J).toFixed(3),analysisBufferLengthInS:parseFloat(P).toFixed(3),analysisBufferSize:G,noOfSpeechChunks:x},events:{noOfEventsStart:t,noOfEventsContinue:s,noOfEventsStop:u,noOfEventsMin:w,noOfEventsMax:v},audioinput:{isCapturing:a,audioInputEvents:O,InputQueueLength:y.length}}},l=function(){return R},m=function(a){try{O++,a&&a.data&&y.push(a.data)}catch(a){Y(a)}},n=function(a){Y(a)},o=function(){return T},p=50,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=[],z=[],A=0,B=-100,C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,Q=!1,R=null,S=!1,T=c.NO_ERROR,U={},V={},W=function(a,b){try{I=a/b,J=1/I,X(b,J,U.analysisChunkLength)}catch(a){Y("_calculateTimePeriods exception: "+a)}},X=function(a,b,c){try{var d=1e3*b;H=Math.ceil(d/c),G=Math.ceil(a/H),P=b/H,K=Math.round(U.speechDetectionAllowedDelay/c),L=Math.round(U.speechDetectionMinimum/c),M=Math.round(U.speechDetectionMaximum/c)}catch(a){Y("_calculateAnalysisBuffers exception: "+a)}},Y=function(a){var b={};a?a.message?b.message=a.message:b.message=a:b.message="An unhandled error has occurred.",U.errorCB&&U.errorCB(b),xa(message),wa(b.message)},Z=function(a){U.speechCapturedCB?U.speechCapturedCB(a):Y("_callSpeechCapturedCB: No callback defined!")},$=function(a){U.speechStatusCB?U.speechStatusCB(a):Y("_callSpeechStatusCB: No callback defined!")},_=function(){try{if(N++,window.audioinput&&audioinput.isCapturing()){var a=aa();a&&a.length>0&&ba(a),setTimeout(_,p)}else Q&&qa(z)}catch(a){Y("_getNextBuffer exception: "+a),$(b.SPEECH_ERROR),ha()}},aa=function(){var a=[];if(y.length>0)for(var b=0;b<U.concatenateMaxChunks&&0!==y.length;b++)a=a.concat(y.shift());return a},ba=function(a){try{for(var c=0;c<H;c++){var d=c*G,e=d+G;if(e>a.length&&(e=a.length),!ca(a.slice(d,e)))return}}catch(a){Y("_iteratedAndMonitorInputBuffer exception: "+a),$(b.SPEECH_ERROR)}},ca=function(a){try{return A+1>M?(pa(z),!1):(da(a)?Q?oa(a,!1):na(a):(Q&&(D++,D>K?qa(z):U.compressPauses||oa(a,!0)),ea()),!0)}catch(a){return Y("_monitor exception: "+a),$(b.SPEECH_ERROR),ha(),!1}},da=function(a){try{if(a&&a.length>0&&(q++,B=fa(a),B&&B>C))return x++,!0}catch(a){Y("_identifySpeech exception: "+a),$(b.SPEECH_ERROR)}return!1},ea=function(){B&&(r++,E+=B,F=E/r,C=F+U.speechDetectionThreshold)},fa=function(a){try{for(var e,f,g,c=0,d=a.length,h=0;h<d;h++)g=Math.abs(a[h]),c+=g*g;return f=Math.sqrt(c/d),e=ga(f)}catch(a){Y("_getAudioLevels exception: "+a),$(b.SPEECH_ERROR)}return null},ga=function(a){return 20*(Math.log(a)/Math.log(10))},ha=function(){Q=!1,ja(),ka(),ia(),s=0,t=0,u=0,v=0,w=0,x=0,O=0,q=0,N=0,B=-100,C=0},ia=function(){E=0,F=0,r=0},ja=function(){y=[]},ka=function(){z=[],A=0,D=0},la=function(){Q=!1,$(b.SPEECH_STOPPED)},ma=function(){Q=!0,$(b.SPEECH_STARTED)},na=function(a){t++,ma(),ka(),oa(a,!1)},oa=function(a,b){s++,ra(a),b||(D=0)},pa=function(a){v++,qa(a),$(b.SPEECH_MAX_LENGTH)},qa=function(a){u++,sa(a),la(),ka()},ra=function(a){z=z.concat(a),A++},sa=function(c){if(c&&c.length>0&&A>L){var d=null,e=c.slice(0);switch(U.audioResultType){case a.WEBAUDIO_AUDIOBUFFER:d=ua(e);break;case a.RAW_DATA:d=e;break;default:case a.WAV_BLOB:d=ta(e)}d&&Z(d)}else w++,$(b.SPEECH_MIN_LENGTH)},ta=function(a){try{var c=new WavAudioEncoder(V.sampleRate,V.channels);return c.encode([a]),c.finish("audio/wav")}catch(a){return Y("_createWAVAudioBuffer exception: "+a),$(b.ENCODING_ERROR),null}},ua=function(a){try{var c=l().createBuffer(V.channels,a.length/V.channels,V.sampleRate);if(V.channels>1)for(var d=0;d<V.channels;d++){for(var e=[],f=0;f<a.length;)e.push(a[f+d]),f+=parseInt(V.channels);c.getChannelData(d).set(new Float32Array(e))}else c.getChannelData(0).set(a);return c}catch(a){return Y("_createWebAudioBuffer exception: "+a),$(b.ENCODING_ERROR),null}},va=function(a){try{return S=!1,a?R=a:R||(window.AudioContext=window.AudioContext||window.webkitAudioContext,R=new window.AudioContext,S=!0),!0}catch(a){return!1}},wa=function(a){U.debugAlerts&&alert(a)},xa=function(a){U.debugConsole&&console.error(a)};return{STATUS:b,AUDIO_RESULT_TYPE:a,DEFAULT:d,start:e,stop:f,isCapturing:g,getCurrentVolume:j,isSpeakingRightNow:h,getCfg:i,getMonitoringData:k,getAudioContext:l,getLastErrorCode:o,onAudioInputCapture:m,onAudioInputError:n}}(),function(a){var b=Math.min,c=Math.max,d=function(a,b,c){for(var d=c.length,e=0;e<d;++e)a.setUint8(b+e,c.charCodeAt(e))},e=function(a,b){this.sampleRate=a,this.numChannels=b,this.numSamples=0,this.dataViews=[]};e.prototype.encode=function(a){for(var d=a[0].length,e=this.numChannels,f=new DataView(new ArrayBuffer(d*e*2)),g=0,h=0;h<d;++h)for(var i=0;i<e;++i){var j=32767*a[i][h];f.setInt16(g,j<0?c(j,-32768):b(j,32767),!0),g+=2}this.dataViews.push(f),this.numSamples+=d},e.prototype.finish=function(a){var b=this.numChannels*this.numSamples*2,c=new DataView(new ArrayBuffer(44));d(c,0,"RIFF"),c.setUint32(4,36+b,!0),d(c,8,"WAVE"),d(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,this.numChannels,!0),c.setUint32(24,this.sampleRate,!0),c.setUint32(28,4*this.sampleRate,!0),c.setUint16(32,2*this.numChannels,!0),c.setUint16(34,16,!0),d(c,36,"data"),c.setUint32(40,b,!0),this.dataViews.unshift(c);var e=new Blob(this.dataViews,{type:"audio/wav"});return this.cleanup(),e},e.prototype.cancel=e.prototype.cleanup=function(){delete this.dataViews},a.WavAudioEncoder=e}(self);